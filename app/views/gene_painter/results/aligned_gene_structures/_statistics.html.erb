<% 
  std_path = "#{Rails.root}/public/tmp/#{controller.id}-std.txt"
  names_table = get_sequence_names(std_path)
  patterns_table, intron_num_table = get_table(std_path, 'stats_non_intron_phase', 
    {
      col_group_class: "intron_num_pattern_column",
      intron_numbers_table: "intron_pos",
    })

  stats_path = "#{Rails.root}/public/tmp/#{controller.id}-stats.txt"
  stats_table = get_statistics_table(stats_path, "stats_info")
 %>

<div id='stats'>
  <div id='stats-left-column'>
    <div id='stats-left'>
      <%= names_table.html_safe %>
    </div>
    <div id='intron_pos'>
      <table>
        <tr>
          <td>>Intron number</td>
        </tr>
      </table>
    </div>
  </div>

  <div id='stats-right-column'>
    <div id='stats-right' style='padding-left: 10px'>
      <%= patterns_table.html_safe %>
    </div>
    <div id='intron_pos' style='overflow: hidden; padding-left: 10px'>
      <%= intron_num_table.html_safe %>
    </div>
  </div>


  <%= javascript_tag defer: 'defer' do -%>

    // simultaneously scroll up/down, left/right
    $('div#stats-right').on('scroll', function() {
      $('div#stats-left').scrollTop($(this).scrollTop());
      $('div#intron_pos').scrollLeft($(this).scrollLeft());
    });

    $('div#stats-left').on('scroll', function() {
      $('div#stats-right').scrollTop($(this).scrollTop());
    });

   <% end -%>
</div>
<br style="clear:both" />
<div id="stats_table" class="clear-fix">
  <%= stats_table.html_safe %>
</div>

<script type="text/javascript">

  var tIntronpos = $('table#intron_pos')[0];
  var tPattern = $('table#stats_non_intron_phase')[0];
  var rowIntronpos, rowPattern, cellIntronpos, cellPattern;
  var intron_num = 1;

  rowIntronpos = tIntronpos.insertRow(-1);
  rowPattern = tPattern.insertRow(-1);

  for (var i = 0; i < n_cols; i++) {
    cellIntronpos = rowIntronpos.insertCell(-1);
    cellPattern = rowPattern.insertCell(-1);

    // set text of the cell based on number of introns in the column
    var nIntrons = parseInt(allCells[i].className.split(' ')[0].split('-')[1]);

    cellIntronpos.setAttribute('class', nIntrons);

    if (nIntrons == 0) {
      cellIntronpos.innerText = '-';
      cellPattern.innerText = '-';
    } else {
      cellIntronpos.innerText = intron_num.toString();
      cellPattern.innerText = intron_num.toString();
      intron_num += 1;
    }
  }

  cellIntronpos = rowIntronpos.insertCell(-1); // insert dummy cell
  cellIntronpos.innerHTML = "&nbsp;";

  cellIntronpos = rowIntronpos.insertCell(-1); // insert dummy cell
  cellIntronpos.innerHTML = "&nbsp;";

  cellPattern = rowPattern.insertCell(-1); // insert dummy cell
  cellPattern.innerHTML = "&nbsp;";

  cellPattern = rowPattern.insertCell(-1); // insert dummy cell
  cellPattern.innerHTML = "&nbsp;";

  rowPattern.setAttribute("style", "display:none;");


</script>
