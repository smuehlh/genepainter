<% 
	table_body = prepare_table_body(
		controller.sequence_names, 
		controller.genes_to_species_map, 
		controller.gene_structure_to_status_map
	) 

%>
<%=
	content_tag(:div, 
		content_tag(:span, "", 
			:class => "ui-icon ui-icon-closethick warning_close", 
			:style => "display:inline-block;",
			:onclick => "$('#generate_genestruct_warning').hide();"
		) +		
		content_tag(:normal,
			"Gene structures are generated on the fly using the WebScipio API. This will slow GenePainter down. Consider to use the webinterface of <a href='http://www.webscipio.org/' target='_blank' class='external'>WebScipio</a>, which is much faster than the API and offers plenty options.".html_safe,
		),
		:id => "generate_genestruct_warning",
		:class => "warning",
		:style => "display:none;"
	) +
	content_tag(:table, 
		content_tag(:thead, escape: false) do 
			content_tag(:tr) do 
				content_tag(:th, "Analyze", :class => "oce-checkbox-col" ) +
				content_tag(:th, "Gene names", :class => "oce-small-text-col") +
				content_tag(:th, "Gene structures", :class => "oce-small-text-col") +
				content_tag(:th, 
					"Generate gene&nbsp;structure".html_safe,
					:class => "oce-checkbox-col"
				) +
				content_tag(:th, "Species", :class => "oce-species-col")
			end
		end,
		:class => "one-column-emphasis"
	) +
	form_tag(post_call_genepainter_path, remote: true, :id => "dataCenterForm") do
		content_tag(:div, 
			content_tag(:table,
				table_body,
				:class => "one-column-emphasis"
			),
		:class => "large_div"
		) + 
		button_tag("Select All", 
			:type => "button", 
			:id => "toggle_analyse_all",
			:title => "Select all genes for analysis."
		) +
		button_tag("Deselect All",
			:type => "button",
			:id => "toggle_analyse_none",
			:title => "Deselect al genes for analysis."
		) +
		content_tag(:br) +
		hidden_field_tag(:is_example, false) +
		submit_tag("Submit", 
			:id => "data_center_button",
			:title => "Hit submit to start GenePainter.",
			:onclick => "hide_show_waiting('show');"
		)
	end +

	content_tag(:p,
		content_tag(:p, "Provide gene structures to start GenePainter. You can upload gene structures generated by <a href='http://www.webscipio.org/' target='_blank' class='external'>WebScipio</a> (recommended) or provide a mapping between species and genes and select the gene structure generation.".html_safe) +
		content_tag(:b, "Press submit when finished with data selection.")
	)
%>

<script defer>

	// onclick of analyse-checkboxes (select all/ deselect all)
	$(".analyse_checkbox").click(function() {
		update_datacenter_checkboxes(this);
	});
	// # trigger('click') is neccessary to make jquery-click trigger events
	$("#toggle_analyse_all").click(function(){
		// warning: this is a hotfix that looks quite insane 
		// the goal: have each analyse-checkbox checked and the onclick-event triggered
		// the approach: 1) set checked to false (!!!), 2) trigger click event (sets checked to true again)
		$('.analyse_checkbox').prop('checked', false).trigger('click');
	});
	$("#toggle_analyse_none").click(function() {
		// warning: this is a hotfix that looks quite insane 
		// the goal: have each analyse-checkbox checked and the onclick-event triggered
		// the approach: 1) set checked to true(!!!), 2) trigger click event (sets checked to false again)
		$('.analyse_checkbox').prop('checked', true).trigger('click');
	});

	// onclick of generate-checkbox 
	$(".generate_checkbox").click(function() {
		if (this.checked) {
			$('#generate_genestruct_warning').show();
		} else {
			$('#generate_genestruct_warning').hide();
		}
	});
</script>

<%

# TODO
# really do ???
# submit button is enabled and info-text hidden when 
# a) there is min. 1 gene structure (done in upload_gene_structures.js.erb)
# OR
# b) there is min. 1 generate-checkbox checked (done onclick)

%>