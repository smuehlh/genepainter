<% require 'gene_painter_helper.rb' %>
<% if @fatal_error.blank? then %>
  <% if @seq_names.length > 0 %>
    // update name of uploaded file
    $('#uploaded_sequence').html('<%= @basename %>');

    var $btnAddSpecies = $('#btnAddSpecies'),
    $initialBlock = $('div.add_species_input');

    // enable button and uploaders
    $('#gene_structures_uploader').prop('disabled', false);
    $('#species_mapping_uploader').prop('disabled', false);
    $btnAddSpecies.prop('disabled', false);

    // hide loading screen
    hide_show_waiting('hide');

    $('.add_species_input').html('');
    $('.add_species_input').append($('<%= add_species(@seq_names) %>'));

    seq_names = $initialBlock.find('ul input');
    seq_names.click(function() {
      disable($btnAddSpecies, false);
      if (getSelectedItems(seq_names).length == seq_names.length)  {
        disable($btnAddSpecies, true);
      }
    });

    // bind event to add species button
    $btnAddSpecies.click(addSpeciesMappingBlock);

    // Initial data center table
    var $dataTableBody = $($('div#data_table').find('tbody')[0]);
    $dataTableBody.html('');
    $dataTableBody.append('<%= create_data_center_table(controller.seq_names).html_safe %>');

    // Show data center
    $('div#b_data_center').toggle("slow");

  <% end %>
<% else%>
  hide_show_waiting('hide');
  alert('Error occurred.');

  // toggle help
  $("div#upload_seq_help").show('slow');
<% end %>
