<div id='text-based' style='font-family: Courier;'>
  <%=
    generate_text_based_output('/fab8/vbui/genepainter_resources/output/out-std.txt').html_safe
   %>

   <%= javascript_tag defer: 'defer' do -%>
     var colors = intronCountsToColors();

     function colorLastRow() {
       var numberOfCells = $($('div#text-based').find('tr')[0]).children().length;
       var tmpElement = '<tr id="lastRow">';

       for (var i = 0; i < numberOfCells; i++) {
         if (i > 0) {
           // build css color, e.g.: rgb(255, 255, 255);
           var rgbVal;
           if (colors[i-1].red == 0 && colors[i-1].green == 51 && colors[i-1].blue == 255) {
             rgbVal = 'rgb(255, 255, 255)';
           } else {
             rgbVal = 'rgb(' + colors[i-1].red + ', ' + colors[i-1].green + ', ' + colors[i-1].blue + ')';
           }

           tmpElement += '<td style="background-color: ' + rgbVal + '">&nbsp;</td>';
         } else {
           tmpElement += '<td>&nbsp;Merged</td>';
         }
       }

      tmpElement += '</tr>';
      $($('div#text-based').find('tbody')[0]).append(tmpElement);
     }

     colorLastRow();
   <% end -%>
</div>

<h4>View Options</h4>
<table>
  <tr>
    <td>
      <%=
        content_tag(:div,
          check_box_tag('highlight_unique') +
          content_tag(:span, 'Highlight unique introns', :style => 'padding-left: 5px; padding-right: 20px')
          )
      %>

      <%= javascript_tag defer: 'defer' do -%>
        $('input#highlight_unique').change(function() {
          var styleOrNot = $(this).is(':checked');

          highlightUniqIntrons(styleOrNot);
        });
      <% end -%>

      <%=
        content_tag(:div,
          check_box_tag('highlight_common') +
          content_tag(:span, 'Highlight introns with at least ', :style => 'padding-left: 5px;') +
          '<input id="spinner" name="value" style="width: 25px;">'.html_safe + ' % in common.'
          )
      %>

      <%= javascript_tag defer: 'defer' do -%>
        var spinner = $('#spinner');

        $(function() {
          spinner.spinner({
            spin: function( event, ui ) {
              // Remove disabled attribute if applicable
              $('input#highlight_common').removeAttr('disabled');

              if ( ui.value > 100 ) {
                $( this ).spinner( 'value',  1);
                return false;
              } else if ( ui.value < 1 ) {
                $( this ).spinner( 'value', 100 );
                return false;
              }
            }
          });

          // Set spinner default value
          spinner.spinner( 'value', 1 );
        });

        spinner.on('input', function() {
          if ( isNaN( parseInt(this.value) ) ) {
            $('input#highlight_common').prop('disabled', true);
          } else if ( parseInt(this.value) > 100 || parseInt(this.value) < 1 ) {
            $('input#highlight_common').prop('disabled', true);
          } else {
            $('input#highlight_common').removeAttr('disabled');
          }
        });

        $('input#highlight_common').change(function() {
          var styleOrNot = $(this).is(':checked');

          highlightIntrons(parseInt(spinner.spinner('value')), styleOrNot);
        });

      <% end -%>
    </td>
    <td style='padding-left: 30px;'>
      <%=
        content_tag(:div,
          check_box_tag('show_intron_phase') +
          content_tag(:span, 'Show intron phase', :style => 'padding-left: 5px; padding-right: 20px')
          )
      %>

      <%= javascript_tag defer: 'defer' do -%>
        var $textBasedTable = $('div#text-based');

        $('input#show_intron_phase').change(function() {
          var showOrNot = $(this).is(':checked');

          if (showOrNot) {
            $textBasedTable.html('<%=
              generate_text_based_output("/fab8/vbui/genepainter_resources/output/out-intron-phase.txt").html_safe
             %>');
          } else {
            $textBasedTable.html('<%=
              generate_text_based_output("/fab8/vbui/genepainter_resources/output/out-std.txt").html_safe
             %>');
          }

          colorLastRow();
        });
      <% end -%>
    </td>
  <tr>
</table>
