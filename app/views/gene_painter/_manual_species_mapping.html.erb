<div id="manual_mapping" style="max-height: 300px; overflow: auto">
  <div style="width: 25%; max-height: 250px; float: left">

      <input type="text" id="species" style="width: 150px"/>

  </div>

  <div id="headers" style="width: 25%; max-height: 250px; overflow: auto; float: left; margin-right: 20px;">


  </div>

  <div style="max-height: 250px; overflow: auto;">

    Unlink genes from species

    <img id="unlink_genes_from_species" src="/assets/icons/popup_icon.png" style="margin-left: 10px; cursor: pointer">

  </div>

</div>

<div style="padding-top: 10px;">
  <input id="map_to_another_species" type="button" value="Map to another species" disabled="true">
</div>

<script defer>
  $("input#map_to_another_species").click(function() {

    var selectedHeaders = _.filter($("div#headers").find("input"), function(input) {
      return $(input).is(":checked");
    });

    var error_message = "";
    var species_name = $("input#species")[0].value;

    if (species_name.length) {
      if (selectedHeaders.length) {

        // $("div#mapped_headers").append(species_name + " => ");
        //
        // _.each(selectedHeaders, function(header) {
        //   $("div#mapped_headers").append(header.value + " ");
        // });
        //
        // $("div#mapped_headers").append("<br/><br/>");


        // Update data center
        var $data_table = $("div#data_table");


        var data = "";
        _.each(selectedHeaders, function(header) {
          data += header.value;

          if (header === _.last(selectedHeaders)) {
            data += ":";
          } else {
            data += ",";
          }

        });

        data += "\"" + species_name + "\"";

        // Call genepainter controller
        $.ajax({
          type: 'POST',
          url: '/insert_species_mapping',
          data: {'new_mapping': data},
          dataType: 'script'
        });

      } else {
        error_message += "No headers are selected.\n";
      }
    } else {
      error_message += "Species name is empty.\n";
    }

    // Update UI
    if (error_message.length) {
      error(error_message);
    } else {
      $("input#species")[0].value = "";

      var selectedLabels = _.filter($("div#headers").find("label"), function(label) {
        return $($(label).children()[0]).is(":checked");
      });

      _.each(selectedLabels, function(label) {
        $(label).next().remove();
        $(label).remove();
      });

    }


  });
</script>
