<% if @fatal_error.blank? then %>
  hide_show_waiting('hide');

  // Update number of files uploaded
  var $fileCount = $('span#uploaded_gene_structures');

  if ($fileCount.text() == "No files uploaded") {
    $fileCount.text('1 file uploaded');
  } else {
    var curTotal = parseInt($fileCount.text().split(' ')[0]);
    curTotal += 1;

    $fileCount.text(curTotal + ' files uploaded');
  }

  // Update gene structure status
  var basename = _.first('<%= @filename %>'.split('.'));
  var $span = $('span#' + basename);

  if ($span.length) {
    $span.html('<%= gene_structure_status(@filename) %>');

    // Give the user option to generate gene structure if missing
    if ($span.html != 'missing') {
      $span.parent().next().html('');
    }
  }

  var count = _.filter($('input#view'), function(item) {
    return $(item).is(':checked');
  }).length;

  if (count < 20) {
    $(_.filter($('input#view'), function(item) {
        return $(item).attr('data') == basename
      })).removeAttr('disabled').prop('checked', true);
  } else {
    $(_.filter($('input#view'), function(item) {
        return $(item).attr('data') == basename
      })).removeAttr('disabled');
  }

<% else%>
  hide_show_waiting('hide');
  alert('Error occurred.');

  // toggle help
  $("div#upload_gene_structures_help").show("slow");
<% end %>
